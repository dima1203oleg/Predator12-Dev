# Технічне завдання: Nexus Core (веб-інтерфейс “космос” з максимальним креативом та usability)

## 1. Мета
Створити ультрасучасний, інтуїтивний портал керування Predator11, де головний агент-гід — надреалістичне кібер-обличчя в зеленій сітці/кліточці — не просто веде діалог (текст/голос/жести), а стає справжнім “кібер-другом” користувача. Інтерфейс повинен вражати візуально (як з sci-fi фільму), бути максимально зручним для щоденного використання (швидка навігація, персоналізація, мінімальний клік-рахунок) та повністю функціональним: реальні потоки даних візуалізуються в реальному часі, агенти реагують миттєво, а кожна взаємодія — креативна та захоплююча. Додамо “вау-ефекти” для креативу (наприклад, голографічні проекції, інтерактивні частинки) та фокус на usability (адаптивність, голосовий контроль, персоналізовані підказки).

---

## 2. Візуальна концепція “кібер-обличчя” з креативними доповненнями
- **Стиль**: темний космічний фон (градієнт від антрациту до глибокого космосу з зірками/небулою) + неоново-зелена сітка (#00FF66) поверх 3D-обличчя. Креатив: іридесцентні “кібер-аури”, голографічні шум/скан-лінії з випадковими “глюками”, інтерактивна реакція на курсор/жести.
- **Матеріали/шейдери**:
  - База: PBR/Phong (low/med poly + normal map + displacement для “живого” ефекту шкіри)
  - Wireframe-оверлей (“кліточка”) + Fresnel + bloom + “кібер-частинки” (еміттери, як зоряний пил)
  - Пульсуючі “нейромережеві прожилки” (тонкі лінії-потоки), що тимчасово формують символи/іконки
- **Станові анімації гіда**:
  1) Idle — тихий пульс, мікро-міміка, моргання, випадкові “скан-огляди” інтерфейсу
  2) Listening — підсвітка скронь, індикатор рівня голосу з підказками
  3) Thinking — зелені обчислювальні частинки, “хмара ідей” з ключовими словами
  4) Speaking — ліп-синк по віземах, субтитри-голограми
  5) Alert — червоні акценти, “шок-хвиля” + haptic feedback
- **Рівні реалізму / фолбек**:
  - Full 3D (Three.js/WebGL2) з blend-shapes/морф-таргетами + WebXR (фіче-флаг)
  - 2.5D Canvas fallback (заздалегідь рендерені секвенції + шейдерні ефекти)
  - Автовибір за FPS/GPU/налаштуваннями, ручний перемикач “lite”

---

## 3. Роль гіда і зв’язок з агентами (креатив + usability)
- NexusGuide як персоналізований агент: запам’ятовує уподобання (тема, стислості пояснень, шорткати).
- **Алгоритм**:
  1) Вхід (голос/текст/жести) → визначення наміру (AI автопідказки)
  2) Візуалізація маршруту (QueryPlanner/ModelRouter) — “кібер-стрілки”
  3) Доставка задач агентам (ETL, OSINT, Graph, Forecast) — агенти “оживають” на мапі
  4) Повернення результатів → пояснення + голографічні проекції даних
- **Функції гіда**:
  - Навігація по інтерфейсу (“відкрий аналітичну палубу”, “покажи аномалії за добу”)
  - Коментування аналітики (пояснення графіків/ризиків/впевненості) з інтерактивними тултіпами
  - Візуальний роутер потоків: куди пішов запит, які компоненти/черги/бази задіяні
  - Жодних “муляжів”: усі кнопки — реальні бек-процеси з прогресом та ETA

---

## 4. Ключові екрани (креатив + usability)
### 4.1 Головний екран (“Міст”)
- Ліва навігація-кристали (Дані, OSINT, Граф, Прогноз, Вулик агентів, Інциденти, OpenSearch, Адмін)
- Центр: кібер-обличчя гіда + “Пульс системи” (KPI) + персоналізовані віджети (drag-and-drop)
- Права панель: живий лог (Loki) з фільтрами (ефект “стікаючого коду”)
- Нижня панель: швидкі дії (ETL, індексація, what-if) + контекстне меню (right-click)
- Кнопки: мікрофон/чат, майстер імпорту, Data Flow Map

### 4.2 Майстер імпорту (“Телепортація даних”)
- Drag&Drop → анімація “розпаду” файлу, прогрес-бар + стрім у Flow Map
- Вибір сховища (MinIO, Postgres staging), пайплайн ETL, індексація (OpenSearch/Qdrant)
- Submit → WS-оновлення кроків (upload → validate → transform → index) + preview-сканер
- Результат: лінк на індекс/колекцію, кнопка “Поділитися результатом”

### 4.3 Data Flow Map (“мульт-візуальний пульт”)
- 3D/2D вузли як “планети” + орбіти потоків, жестове керування, voice-фільтри
- Анімація частинок по ребрах; колір стану (зелений/жовтий/червоний)
- Клік по вузлу → голографічна карточка метрик з посиланнями (Grafana/Loki/OpenSearch)

### 4.4 MAS Supervisor (агенти)
- 3D-“вулик”: світні точки/лінії, “дихання”, міграція під навантаженням
- KPI: RPS, помилки, latency, бюджет; сортування/фільтри; експорт CSV
- Дії: перезапуск/блок/зміна політики; Self-Diagnosis/AutoHeal, журнал автофіксів

### 4.5 OpenSearch “Аналітична палуба”
- Вбудовано (iframe/proxy), SSO Keycloak, кастомний неон-фрейм
- Експорт графіків/звітів у Report Export (шаблони з drag-and-drop)

### 4.6 Хроно/Граф/Прогноз
- 3D-Земля + “часові шари”; 3D-граф зв’язків з drill-down; what-if симуляції

---

## 5. Архітектура фронтенду (з usability-доповненнями)
- Стек: React 18 + TypeScript, Three.js (WebGL2), D3.js, Zustand/Redux, MUI, Framer Motion, Web Workers, OffscreenCanvas, Web Speech API, Howler.js, @use-gesture/react, PWA
- Структура: /app, /components, /guide_face, /flowmap, /opensearch, /widgets, /personalization, /state, /api, /themes, /assets
- Ключові компоненти: HolographicGuide, DataFlowMap, ImportWizard, MASSupervisor (3D вулик), OpenSearchPanel, ChronoSpatialMap, GraphView3D, ForecastLab
- Продуктивність (M3 8GB): FPS 60 таргет; LOD; offscreen рендер; workers; auto-lite < 30 FPS

---

## 6. Бекенд-контракти
- FastAPI REST/WS (реальні потоки, прогрес, idempotency), OpenSearch/Qdrant, MinIO

---

## 7. Візуалізація потоків
- Імпорт: зелений струмінь Browser→Backend→MinIO; ETL — бірюзовий; індексація — сапфіровий; помилка — червоний спалах + тултіп з логом
- Запити: маршрут Guide→ModelRouter→Агент→OpenSearch/Qdrant→Відповідь; клікабельні сегменти

---

## 8. Безпека (з usability)
- SSO Keycloak, HttpOnly cookies, CSRF; біометрія WebAuthn; MFA/FIDO2 зі сканером
- RBAC: приховування елементів; тултіп “чому приховано?”; телеметрія opt-in

---

## 9. Доступність і локалізація
- Клавіатурна навігація, aria; субтитри з неон-ефектами; UA/EN з auto-detect

---

## 10. Тестування та DoD
- Візуальні (Playwright, pixel-diff ≤1%), smoke для гіда/агентів/OpenSearch, usability A/B, heatmaps

---

## 11. Продакшн вимоги
- PWA, офлайн-режим, push-повідомлення; Helm/ENV фіче-флаги; observability; canary

---

## 12. Результат
- Надреалістичний гід-кіберфейс з креативом і інтуїтивністю, мульт-візуальний пульт потоків, дієві кнопки з реальними бек-процесами, готовність до продакшн.

---

## 13. Гібридна модель: OpenSearch Dashboard (embed) + кастомний React

### Коротко
- Щоденні дослідження й карти — вбудований OpenSearch Dashboard (SSO, embed).
- Продуктові екрани і керування пайплайнами — кастомний React над OpenSearch/Postgres/Prometheus/Qdrant.

### Чому так
#### Плюси вбудованого OpenSearch Dashboard
- Швидкий старт: готові карти, фільтри, пошук, агрегації, TSVB, Lens.
- Адміністрування індексів і шаблонів прямо в UI.
- Збережені візуалізації/дашборди, шеринґ, експорти.
- Timepicker, KQL/DSL без коду.
- Менше коду у фронтенді.

#### Мінуси
- Обмеження кастомної логіки/UX і крос-джерельних джойнів (OS + Postgres + Qdrant).
- Складніше повне підганяння під бренд-тему.
- Особливості SSO/embed/RBAC.

#### Плюси власного UI
- Точний UX під сценарії (Self-Healing, ETL, «1-клік» дії).
- Комбіновані дані (OS + Postgres + Prometheus + Qdrant).
- Краща продуктивність за рахунок спроєктованих запитів.
- Повний контроль темізації.

#### Мінуси
- Більше розробки, кеші, DSL, пагінація, безпека, QA.

### Рекомендована схема
- Аналітична Палуба (client-facing) → OpenSearch Dashboard (SSO, embed).
- Nexus Core (admin/operator) → кастомні екрани: Intake/ETL, Self-Diagnosis, Auto-Heal, Реєстри, Алерти.
- Джерела: OpenSearch (пошук/агрегації), Postgres/Timescale (джоби/етапи/черги), Prometheus (latency/throughput), Loki (логи jobId), Qdrant (схожість).

### Коли переходити від embed до кастомного
- Потрібні дії з картки (retry, quarantine to DLQ, restart job).
- Потрібні крос-джойни з бізнес-правилами.
- Потрібен brand-UX або складні віджети (what-if, симулятор).
- Multi-tenant з тонким RBAC до рівня полів/документів.

### Як втілити
#### Embed OpenSearch у «Аналітичну Палубу»
- Проксі /osd/* → OpenSearch Dashboards; SSO Keycloak OIDC; дозволити embedded mode + CSP.
- <iframe src="/osd/app/dashboards#/view/<ID>?embed=true&_g=...&_a=...">; глобальні фільтри передавати через &_g.

#### Кастомний React над OpenSearch
- KPI/плитки: /_search з aggs + filters; кеш через React Query.
- Крос-джерельні даші: бекенд endpoint, що збирає OS + PG + Prometheus і повертає зведення.
- View-індекси в OpenSearch з нормалізованими полями (дати, keyword) для продуктивності.

### План етапів
- Етап 0: Вбудувати існуючі OS дашборди; SSO + RBAC; темна тема.
- Етап 1: Кастомні екрани Intake/ETL/Pipelines/Monitoring (OS+PG+Prometheus+Loki) з діями.
- Етап 2: Крос-аналітика (митні↔податкові↔OSINT), симулятор сценаріїв, граф зв’язків; поступова міграція критичних метрик у кастомні плитки.
