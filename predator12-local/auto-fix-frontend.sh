#!/bin/bash

echo "üîß –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –§–†–û–ù–¢–ï–ù–î–£"
echo "===================================="

# –ó—É–ø–∏–Ω–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤
echo "1. –ó—É–ø–∏–Ω–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤..."
docker-compose down

# –û—á–∏—Å—Ç–∫–∞
echo "2. –û—á–∏—Å—Ç–∫–∞ Docker –∫–µ—à—É..."
docker system prune -f

# –ü–µ—Ä–µ—Ö—ñ–¥ –≤ –ø–∞–ø–∫—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É
echo "3. –û—á–∏—Å—Ç–∫–∞ dist –ø–∞–ø–∫–∏..."
cd /Users/dima/Documents/Predator12/predator12-local/frontend
rm -rf dist node_modules/.cache

# –ü–µ—Ä–µ–±—É–¥–æ–≤–∞
echo "4. –ü–µ—Ä–µ–±—É–¥–æ–≤–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É..."
npm run build

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
echo "5. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ build —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É..."
if [ -f "dist/index.html" ]; then
    echo "‚úÖ Build —É—Å–ø—ñ—à–Ω–∏–π"
    echo "–ü–µ—Ä—à—ñ —Ä—è–¥–∫–∏ index.html:"
    head -5 dist/index.html
else
    echo "‚ùå Build –Ω–µ –≤–¥–∞–≤—Å—è"
    exit 1
fi

# –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –∫–æ—Ä–Ω–µ–≤–æ—ó –ø–∞–ø–∫–∏
cd /Users/dima/Documents/Predator12/predator12-local

# –ü–µ—Ä–µ–±—É–¥–æ–≤–∞ Docker –æ–±—Ä–∞–∑—É
echo "6. –ü–µ—Ä–µ–±—É–¥–æ–≤–∞ Docker –æ–±—Ä–∞–∑—É..."
docker-compose build --no-cache frontend

# –ó–∞–ø—É—Å–∫
echo "7. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞..."
docker-compose up -d frontend

# –û—á—ñ–∫—É–≤–∞–Ω–Ω—è
echo "8. –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–ø—É—Å–∫—É (10 —Å–µ–∫—É–Ω–¥)..."
sleep 10

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è
echo "9. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ..."
curl -f http://localhost:3000/ >/dev/null 2>&1 && echo "‚úÖ Frontend –¥–æ—Å—Ç—É–ø–Ω–∏–π" || echo "‚ùå Frontend –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π"

echo "===================================="
echo "üéâ –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –ó–ê–í–ï–†–®–ï–ù–û!"
echo "–í—ñ–¥–∫—Ä–∏–π—Ç–µ: http://localhost:3000"
